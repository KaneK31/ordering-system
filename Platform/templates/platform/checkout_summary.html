{% extends "platform/base.html" %}
{% block title %}Checkout Summary{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Checkout Summary</h2>

    {% if cart_items %}
    <!-- Order Table -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            Your Order
        </div>
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead>
                <tr>
                    <th>Product</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-end">Price</th>
                    <th class="text-end">Subtotal</th>
                </tr>
                </thead>
                <tbody>
                {% for item in cart_items %}
                <tr>
                    <td>{{ item.product.product_name }}</td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end">Â£{{ item.product.product_price }}</td>
                    <td class="text-end">Â£{{ item.total_price|floatformat:2}}</td>
                </tr>
                {% endfor %}
                <tr class="fw-bold">
                    <td colspan="3" class="text-end">Total:</td>
                    <td class="text-end">Â£{{ total_price|floatformat:2 }}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ðŸ“¦ Shipping Address Form -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white">
            Shipping Details
        </div>
        <div class="card-body">
            <form method="post" class="row g-3">
                {% csrf_token %}
                {% for field in address_form %}
                <div class="col-md-6">
                    <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                    <div class="text-danger small">{{ field.errors|striptags }}</div>
                    {% endif %}
                </div>
                {% endfor %}
                <div class="col-12">
                    <button type="submit" class="btn btn-outline-primary w-100">Save Address</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ðŸ’³ PayPal Payment -->
    <div class="text-center mt-4">
        {% if address_saved %}
        <p class="mb-2">Click the button below to proceed with payment via PayPal:</p>
        <form action="https://www.sandbox.paypal.com/cgi-bin/webscr" method="post">
            {{ paypal_form.as_p }}
            <button type="submit" class="btn btn-primary">Pay with PayPal</button>
        </form>
        {% else %}
        <div class="alert alert-info mt-3">
            Please enter and save your address before paying.
        </div>
        {% endif %}
    </div>

    {% else %}
    <div class="alert alert-info text-center">Your cart is empty.</div>
    {% endif %}
</div>
{% endblock %}
